<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!--        Period Cost-->
        <record id="cost_price_period_form_view" model="ir.ui.view">
            <field name="name">cost_price_period_form_view</field>
            <field name="model">cost.price.period</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="action_calculate" string="Calculate" type="object" states="draft"
                                groups="account.group_account_manager,account.group_account_user"
                                class="oe_highlight"/>
                        <button name="action_done" class="oe_highlight"
                                groups="account.group_account_manager,account.group_account_user"
                                string="Confirm" states="calculate" type="object"/>
<!--                        <button name="action_confirm" class="oe_highlight"-->
<!--                                groups="account.group_account_manager,account.group_account_user"-->
<!--                                string="Confirm" attrs="{'invisible' : ['|',('state', '!=', 'draft'),('type','!=','manual')]}"  type="object"/>-->
                        <button name="action_import_line" type="object" class="oe_highlight" string="Import"
                                attrs="{'invisible': [('field_binary_import', '=', False)]}"/>
                        <button name="action_back"
                                groups="ev_account_cost_price.group_cost_price_period_cancel"
                                string="Back" states="calculate,confirm,done" type="object"/>
<!--                        <button name="action_done" class="oe_highlight"-->
<!--                                groups="account.group_account_manager,account.group_account_user"-->
<!--                                string="Done" states="confirm" type="object"/>-->
                        <field name="state" widget="statusbar" statusbar_visible="draft,calculate,done" readonly="1"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <div class="oe_title">
                                    <label for="name" class="oe_edit_only"/>
                                    <h1>
                                        <field name="name" placeholder="Name" required="1" readonly="1"
                                               attrs="{'readonly': [('state','!=','draft')]}"/>
                                    </h1>
                                </div>
                            </group>
                        </group>
                        <group string="Condition">
                            <group>
                                <field name="account_fiscal_month_id" attrs="{'readonly': [('state','!=','draft')]}" required="1"
                                       options="{'no_quick_create':True,'no_create_edit':True}"/>
                                <field name="type" invisible="1"/>
                            </group>
                            <group>
                                <field name="date" required="1" attrs="{'readonly': [('state','!=','draft')]}"/>
                                <field name="company_id" required="1" readonly="1" force_save="1" groups="base.group_multi_company"
                                       options="{'no_quick_create':True,'no_create_edit':True}"/>
                                <field name="account_id" options="{'no_quick_create':True,'no_create_edit':True}"
                                        attrs="{'readonly': [('state','!=','draft')], 'invisible' : [('type','=','manual')]}"/>
                                <field name="activity" invisible="1" readonly="1" force_save="1"/>
                            </group>
                        </group>
                        <group attrs="{'invisible': [('state','=','done')]}">
                            <field name="note1" readonly="1" force_save="1" nolabel="1" style="color:red"
                            attrs="{'invisible' : [('type','=','manual')]}"/>
                        </group>
                        <group attrs="{'invisible': [('state','=','done')]}">
                            <field name="note2" readonly="1" force_save="1" nolabel="1" style="color:red"
                            attrs="{'invisible' : [('type','=','manual')]}"/>
                        </group>
                        <field name="activity" invisible="1" readonly="1" force_save="1"/>
                        <notebook>
                            <page name="period_line" string="Products">
                                <field name="field_binary_import" filename="field_binary_name"
                                       attrs="{'invisible' : ['|',('state', '!=', 'draft'),('type','!=','manual')]}"/>
                                <field name="field_binary_name" invisible="1"/>
                                <button name="download_template" type="object" string="Download Import Template"
                                        class="btn btn-link" style="text-decoration: underline;"
                                        help="Mẫu import có định dạng là xls hoặc xlsx"/>
                                <field name="period_lines" attrs="{'readonly': [('state','=','done')]}">
                                    <tree editable="1" create="0" delete="0">
                                        <field name="product_id" required="1" attrs="{'readonly': [('parent.type','=','auto')]}"
                                               options="{'no_quick_create':True,'no_create_edit':True}"/>
                                        <field name="uom_id" options="{'no_quick_create':True,'no_create_edit':True}" readonly="1"
                                               force_save="1"/>
                                        <field name="qty_initial" style="color:Turquoise" readonly="1" force_save="1"/>
                                        <field name="value_initial" style="color:Turquoise" readonly="1" force_save="1"/>
                                        <field name="qty_in" readonly="1" force_save="1" string="Quantity in"/>
                                        <field name="value_in" readonly="1" force_save="1"/>
                                        <field name="standard_price" style="color:red"/>
                                        <field name="method_add" invisible="1"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
        <record id="account_cost_price_period_view" model="ir.ui.view">
            <field name="name">cost_price_period_tree_view</field>
            <field name="model">cost.price.period</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="account_fiscal_month_id"/>
                    <field name="company_id"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!--        action-->
        <record id="action_cost_price_period" model="ir.actions.act_window">
            <field name="name">Cost of Goods in the Period Materials</field>
            <field name="res_model">cost.price.period</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'default_type': 'auto'}</field>
            <field name="domain">[('type','=','auto')]</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('account_cost_price_period_view')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('cost_price_period_form_view')})
                ]"/>
        </record>

        <menuitem id="menu_action_cost_price_period" parent="account.menu_finance_entries"
                  name="Cost of Goods in the Period"
                  groups="account.group_account_manager,account.group_account_user"
                  sequence="5" action="action_cost_price_period"/>

        <record id="action_cost_price_period_manual" model="ir.actions.act_window">
            <field name="name">Cost of Goods in the Period Manual</field>
            <field name="res_model">cost.price.period</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'default_type': 'manual'}
            </field>
            <field name="domain">
                [('type','=','manual')]
            </field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('account_cost_price_period_view')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('cost_price_period_form_view')})
                ]"/>
        </record>

        <menuitem id="menu_cost_price_period_manual" parent="account.menu_finance_entries"
                  name="Cost of Goods in the Period Manual"
                  groups="account.group_account_manager,account.group_account_user"
                  sequence="99" action="action_cost_price_period_manual"/>


        <!--        Period Cost Line-->
        <record id="cost_price_period_line_form_view" model="ir.ui.view">
            <field name="name">cost_price_period_line_form_view</field>
            <field name="model">cost.price.period.line</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <group>
                            <group>
                                <field name="product_id"/>
                                <field name="qty_initial"/>
                                <field name="qty_in"/>
                            </group>
                            <group>
                                <field name="uom_id"/>
                                <field name="value_initial"/>
                                <field name="value_in"/>
                            </group>
                        </group>
                        <group class="oe_subtotal_footer oe_left">
                            <field name="standard_price" widget="monetary" style="color:red"/>
                        </group>
                        <notebook>
                            <page string="Move lines" name="lines">
                                <field name="lines">
                                    <tree>
                                        <field name="period_line_id" invisible="1"/>
                                        <field name="account_move_name"/>
                                        <field name="qty"/>
                                        <field name="value"/>
                                        <field name="description"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>
    </data>
</odoo>